{% load static %}
<!DOCTYPE html>
<html lang="en">
	<head>
	    <meta charset="utf-8">
	    <meta http-equiv="X-UA-Compatible" content="IE=edge">
	    <meta name="viewport" content="width=device-width, initial-scale=1">
	    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
	    <meta name="description" content="">
	    <meta name="author" content="">
      <link rel="icon" href="{% static 'img/favicon.ico'%}">

	    <title>DisEasy</title>

	    <!-- Bootstrap core CSS -->
      <link href="{% static 'css/bootstrap.min.css' %}" rel="stylesheet">

	    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
      <link href="{% static 'css/ie10-viewport-bug-workaround.css' %}" rel="stylesheet">

      <link href='//fonts.googleapis.com/css?family=Abel' rel='stylesheet'>

	    <!-- Custom styles for this template -->
      <link href="{% static 'css/starter-template.css' %}" rel="stylesheet">

      <script src="{% static 'js/ie-emulation-modes-warning.js' %}"></script>

	    <!-- d3.js Javascript
	    =================================================== -->
		<script src="https://d3js.org/d3.v3.min.js"></script>
    <script src="{% static 'js/sampleVisual.js' %}" type="text/javascript"></script>
	   
	    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
	    <!--[if lt IE 9]>
	      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
	      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
	    <![endif]-->

	    <style type = "text/css">
	    	.axis path 
	    	{
			    fill: none;
			    stroke: #333;
			    shape-rendering: crispEdges;
			    font-family: Abel;
			    font-weight: bold;
			    text-rendering: optimizeLegibility;
			    -webkit-font-smoothing: antialiased;
			}
			.axis text 
			{
			    font-family: Abel;
			    font-weight: bold;
			    text-rendering: optimizeLegibility;
			    -webkit-font-smoothing: antialiased;
			    font-size: 13px;
			}
			.nav > li > a:hover,.nav > li > a:focus
			{
	  			background-color: #77bbbb !important;
	  			color:black !important;
	  			text-decoration: none;
	  			font-family: Abel;
			    font-weight: bold;
  			}
  			body
  			{
  				padding-top: 60px;
  				padding-bottom: 60px;
  			}
  			.navbar-nav > li > a, .navbar-nav > li.hover, .navbar-nav > li.active > a:focus, .navbar-nav > li.active > a:hover 
  			{
  				background-color: #77bbbb !important;
  				color:black !important;
  				text-decoration: none;
  				font-family: Abel;
			    font-weight: bold;
  			}
  			.navbar-nav > li.active > a:hover 
  			{
  				background-color: #77bbbb !important;
  				color:grey !important;
  				text-decoration: none;
  				font-family: Abel;
			    font-weight: bold;
  			}
  			.navbar 
  			{
  				min-height:50px !important;
  				max-height:50px !important;
  				padding:0px;
  				color:black;
  				font-family: Abel;
			    font-weight: bold;

  			}
  			.navbar-brand 
  			{
  				padding: 0px;
  				min-height:50px !important;
  				max-height:50px !important;
  				font-family: Abel;
			    font-weight: bold;
  			}
  			.navbar-brand>img 
  			{
  				height: 100%;
  				min-height:50px !important;
  				max-height:50px !important;
  				padding: 0px;
  				width: auto;
  				font-family: Abel;
			    font-weight: bold;
  			}
  			.nav-pills> li.active > a, .nav-pills > li.active > a:hover
  			{
  				background-color: #77bbbb !important;
  				color:black !important;
  				font-family: Abel;
			    font-weight: bold;
  			}
  			.nav-pills > li > a
  			{
  				color: #77bbbb;
  				font-family: Abel;
			    font-weight: bold;
  			}
  			h2, h1
  			{
  				font-family: Abel;
			    font-weight: bold;
  			}
  			

		</style>
	</head>

	<body>
	<div class="container">
		<nav class="navbar navbar-inverse navbar-fixed-top" style = "background-color: #77bbbb; color:black;">
		<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbarButton" aria-expanded="false" aria-controls="navbarButton" style="vertical-align: center">
			<span class="sr-only">Toggle navigation</span>
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
		</button>
		<a class="navbar-brand" href="#"><img src="{% static 'img/diseasylogo.png' %}" width="50" height="50" hspace = "20" alt=""></a>
		<div id = "navbar" class= "navbar-header nav navbar-nav">
		</div>
			<div class="collapse navbar-collapse" id="navbarButton" style="">
				<ul class="nav navbar-nav">
					<li><a href="/form">Home</a></li>
					<li><a href="/about">About</a></li> 
					<li><a href="" style="color: black;">Log-In</a></li>
				</ul>
			</div>
		</nav>
		</div>
		<div class="container">

			<p>You are received the following classification:</p>

			[bar]

			<p>To view the your results relative to the United States population, expand the Glycohemoglobin and Albumin results below. Scroll to view the graphs conditioned by your age range, BMI range, gender, and diabetic status. The y-axis (vertical line) signifies the probability of the lab value specified on the x-axis (horizontal line). The black vertical indicator line marks where your lab result falls.</p>

			<p>Diabetes means your blood glucose, or blood sugar, levels are too high. With type 2 diabetes, the more common type, your body does not make or use insulin well. Insulin is a hormone that helps glucose get into your cells to give them energy. Without insulin, too much glucose stays in your blood. Over time, high blood glucose can lead to serious problems with your heart, eyes, kidneys, nerves, and gums and teeth.</p>

			<p>You have a higher risk of type 2 diabetes if you are older, obese, have a family history of diabetes, or do not exercise. Having prediabetes also increases your risk. Prediabetes means that your blood sugar is higher than normal but not high enough to be called diabetes.</p>

			<p>The symptoms of type 2 diabetes appear slowly. Some people do not notice symptoms at all. The symptoms can include:</p>

			<ul>
			<li>Being very thirsty</li>
			<li>Urinating often</li>
			<li>Feeling very hungry or tired</li>
			<li>Losing weight without trying</li>
			<li>Having sores that heal slowly</li>
			<li>Having blurry eyesight</li>
			</ul>

			<p>Blood tests can show if you have diabetes. One type of test, the A1C, can also check on how you are managing your diabetes. Many people can manage their diabetes through healthy eating, physical activity, and blood glucose testing. Some people also need to take diabetes medicines.</p>

			<p><i>NIH: National Institute of Diabetes and Digestive and Kidney Diseases</i></p>

			<p>If you are concerned about about the results of this evaluation, please consult your primary physician for more information. (Disclaimer: These results are not to be used as a diagnostic tool.)</p>

			<p>The machine-learning model has achieved a ##% classification accuracy based on the our data from the U.S. National Health and Nutrition Examination Survey.</p>
		</div>
		<div class="container">
			<ul class="nav nav-pills nav-stacked">
				<li>
					<a data-toggle="pill" href="#fig">Albumin</a>
				</li>
				<li>
					<a data-toggle="pill" href="#supp">Glycohemoglobin</a>
				</li> 
			</ul>
			<div class="tab-content">
				<div id="fig" class="tab-pane fade in">
					<h2>ALBUMIN FIGURES</h2>
					<div class="container">
					<svg id="albuVisAll" width="1000" height="500"></svg>
					</div>
					<br>
					<div class="container">
					<svg id="albuVisAge" width="1000" height="500"></svg>
					</div>
					<br>
					<div class="container">
					<svg id="albuVisGend" width="1000" height="500"></svg>
					</div>
					<br>
					<div class="container">
					<svg id="albuVisBMI" width="1000" height="500"></svg>
					</div>
					<br>
					<div class="container">
					<svg id="albuVisDiab" width="1000" height="500"></svg>
					</div>
					<br>
					<div class="container">
					<svg id="albuVisNoDiab" width="1000" height="500"></svg>
					</div>
					<br>
					<!--JAVASCRIPT FOR DATA VISUALIZATIONS-->
					<script>
						//dimensions for svg elements
						WIDTH = 1000,
							HEIGHT = 500,
							MARGINS = {
								top: 50,
								right: 20,
								bottom: 50,
								left: 50
							};
						//data
						{% for visualization in visualizations %}

       						var LineData = {{ visualization.as_json|safe }};
							//console.log(LineData);

							//setting scales
							var xScale = d3.scale.linear().range([MARGINS.left, WIDTH - MARGINS.right]).domain([2.5, 5.5]);
							var yScale = d3.scale.linear().range([HEIGHT - MARGINS.top, MARGINS.bottom]).domain([0,1]);

							var vis;
							var maxY = 0;
							var IV = LineData.IV;
							if(IV == "Albumin")
							{
								//console.log("Length of Data array: " + LineData.Data.length);
								var myValues = [];
								for(i = 0; i < LineData.Data.length; i++)
								{
									myValues.push({"value": LineData.Data[i][0], "percentage":LineData.Data[i][1]});
									if(maxY < LineData.Data[i][1])
										maxY = LineData.Data[i][1];

								}
							
								console.log("Max Y value = " + maxY);
								//svg selection
								if(LineData.Feature.Type == "All")
								{
									vis = d3.select("#albuVisAll");
								}
								else if(LineData.Feature.Type == "Age")
								{
									vis = d3.select("#albuVisAge");
								}
								else if(LineData.Feature.Type == "Gender")
								{
									vis = d3.select("#albuVisGend");
								}
								else if(LineData.Feature.Type == "BMI")
								{
									vis = d3.select("#albuVisBMI");
								}
								else if(LineData.Feature.Type == "Diabetic")
								{
									if(LineData.Feature.Value == "True")
									{
										vis = d3.select("#albuVisDiab");
									}
									if(LineData.Feature.Value == "False")
									{
										vis = d3.select("#albuVisNoDiab");
									}
								}

								var xTicks = xScale.ticks();
								xTicks.push({{ albumin  }});

								console.log(xTicks);


								//drawing axis

								var userMark = (-HEIGHT+MARGINS.top+MARGINS.bottom)*maxY;
								console.log("usermark: " + userMark);
							  	var xAxis = d3.svg.axis().scale(xScale).tickValues(xTicks).innerTickSize(userMark);
								var yAxis = d3.svg.axis().scale(yScale).orient("left");

							  	vis.append('g')
							    	.attr('class', 'axis')
							    	.attr('transform', 'translate(0,' + (HEIGHT - MARGINS.bottom) + ')')
							    	.call(xAxis)
							    	.selectAll('text')
								    .style('text-anchor', 'end')
								    .attr('dx', '-.8em')
								    .attr('dy', '.15em')
								    .attr('transform', 'rotate(-65)');

							  	vis.append('g')
								    .attr('class', 'axis')
								    .attr('transform', 'translate(' + (MARGINS.left) + ',' + (MARGINS.top - MARGINS.bottom) + ')')
								    .call(yAxis);

								//add tick for user value
								d3.selectAll('g.tick')
                .filter(function(d){ return d=={{ albumin }} ;} )
									//only ticks that returned true for the filter will be included
									//in the rest of the method calls:
									.select('line') //grab the tick line
									.style('stroke', 'black')
									.style('stroke-width',3)
									.style('shape-rendering', 'crispEdges')
									.style('opacity',0.5);;

								//writting x axis label
								vis.append('text')
							    	.attr('transform', 'translate(' + (WIDTH/2) + ',' + (HEIGHT) + ')')
							    	.attr('y', -5)
							    	.style('text-anchor', 'middle')
							    	.style('font-family', 'Abel')
			    					.style('font-weight', 'bold')
			    					.style('font-size', '20px')
							    	.text(IV + ' Value');

								//writting y axis label
								vis.append('text')
							        .attr('transform', 'rotate(-90)')
							        .attr('y', -5)
							        .attr('x',0 - (HEIGHT / 2))
							        .attr('dy', '1em')
							        .style('text-anchor', 'middle')
							        .style('font-family', 'Abel')
			    					.style('font-weight', 'bold')
			    					.style('font-size', '20px')
							        .text('Probability');

								//drawing data line
							    var lineFunc = d3.svg.line()
							    	.x(function(d)
							    	{
							    		return xScale(d.value);
							    	})
							    	.y(function(d)
							    	{
							    		return yScale(d.percentage);
							    	})
							    	.interpolate("cardinal")
							    	.tension(0.6);

							    vis.append('path')
							    	.attr('stroke', "red")
							    	.attr('opacity', 0.6)
							    	.attr('stroke-width', 4)
							    	.attr('fill', 'none')
							    	.attr('d', lineFunc(myValues));
							    console.log("Read data for: " + LineData.Feature.Type + " " + LineData.Feature.Value);

								//writting Title
							    vis.append('text')
							        .attr('x', (WIDTH / 2))     
							        .attr('y', 0 + (MARGINS.top / 2))
							        .attr('text-anchor', 'middle')
							        .style('font-size', '24px')
							        .style('font-family', 'Abel')
			    					.style('font-weight', 'bold')
							        .text(IV + ' vs ' + LineData.Feature.Type + ' ' + LineData.Feature.Value);
							}
							
						{% endfor %}

					</script>
				</div>
				<div id="supp" class="tab-pane fade">
					<h2>GLYCOHEMOGLOBIN FIGURES</h2>
					<div class="container">
					<svg id="glycoVisAll" width="1000" height="500"></svg>
					</div>
					<br>
					<div class="container">
					<svg id="glycoVisAge" width="1000" height="500"></svg>
					</div>
					<br>
					<div class="container">
					<svg id="glycoVisGend" width="1000" height="500"></svg>
					</div>
					<br>
					<div class="container">
					<svg id="glycoVisBMI" width="1000" height="500"></svg>
					</div>
					<br>
					<div class="container">
					<svg id="glycoVisDiab" width="1000" height="500"></svg>
					</div>
					<br>
					<div class="container">
					<svg id="glycoVisNoDiab" width="1000" height="500"></svg>
					</div>
					<br>
					<!--JAVASCRIPT FOR DATA VISUALIZATIONS-->
					<script>
						//Dimensions for svg elements
						WIDTH = 1000,
						HEIGHT = 500,
						MARGINS = {
							top: 50,
							right: 20,
							bottom: 50,
							left: 50
						};
						//data
						{% for visualization in visualizations %}

							var LineData = {{ visualization.as_json|safe }};
							//console.log(LineData);

							//setting scales
							var xScale = d3.scale.linear().range([MARGINS.left, WIDTH - MARGINS.right]).domain([4, 13.5]);
							var yScale = d3.scale.linear().range([HEIGHT - MARGINS.top, MARGINS.bottom]).domain([0,1]);

							var maxY = 0;
							var vis;
							var IV = LineData.IV;
								
							if(IV == "Glycohemoglobin")
							{
								var myValues = []
								for(i = 0; i < LineData.Data.length; i++)
								{
									myValues.push({"value": LineData.Data[i][0], "percentage":LineData.Data[i][1]})
									if(maxY < LineData.Data[i][1])
										maxY = LineData.Data[i][1];

								}
								if(LineData.Feature.Type == "All")
								{
									vis = d3.select("#glycoVisAll");
								}
								else if(LineData.Feature.Type == "Age")
								{
									vis = d3.select("#glycoVisAge");
								}
								else if(LineData.Feature.Type == "Gender")
								{
									vis = d3.select("#glycoVisGend");
								}
								else if(LineData.Feature.Type == "BMI")
								{
									vis = d3.select("#glycoVisBMI");
								}
								else if(LineData.Feature.Type == "Diabetic")
								{
									if(LineData.Feature.Value == "True")
									{
										vis = d3.select("#glycoVisDiab");
									}
									if(LineData.Feature.Value == "False")
									{
										vis = d3.select("#glycoVisNoDiab");
									}
								}

								var xTicks = xScale.ticks();
								xTicks.push({{ glycohemoglobin  }});

								console.log(xTicks);

								var yTicks = yScale.ticks();
								yTicks.push({{ probability }});

								console.log(yTicks);

								//drawing axis
							  	var userMark = (-HEIGHT+MARGINS.top+MARGINS.bottom) * maxY;
								console.log("usermark: " + userMark);
							  	var xAxis = d3.svg.axis().scale(xScale).tickValues(xTicks).innerTickSize(userMark);
								var yAxis = d3.svg.axis().scale(yScale).orient("left");

							  vis.append('svg:g')
							    .attr('class', 'axis')
							    .attr('transform', 'translate(0,' + (HEIGHT - MARGINS.bottom) + ')')
							    .call(xAxis)
							    .selectAll('text')
							    .style('text-anchor', 'end')
							    .attr('dx', '-.8em')
							    .attr('dy', '.15em')
							    .attr('transform', 'rotate(-65)');

							  vis.append('svg:g')
							    .attr('class', 'axis')
								.attr('transform', 'translate(' + (MARGINS.left) + ',' + (MARGINS.top - MARGINS.bottom) + ')')
								.call(yAxis);

								//add tick for user value
								d3.selectAll('g.tick')
                .filter(function(d){ return d=={{ glycohemoglobin }};} )
									//only ticks that returned true for the filter will be included
									//in the rest of the method calls:
									.select('line') //grab the tick line
									.style('stroke', 'black')
									.style('stroke-width',3)
									.style('shape-rendering', 'crispEdges')
									.style('opacity',0.5);

								//writting x axis label
								vis.append('text')
							    	.attr('transform', 'translate(' + (WIDTH/2) + ',' + (HEIGHT) + ')')
							    	.attr('y', -5)
							    	.style('text-anchor', 'middle')
							    	.style('font-family', 'Abel')
			    					.style('font-weight', 'bold')
			    					.style('font-size', '20px')
							    	.text(IV + ' Value');

								//writting y axis label
								vis.append('text')
							        .attr('transform', 'rotate(-90)')
							        .attr('y', -5)
							        .attr('x',0 - (HEIGHT / 2))
							        .attr('dy', '1em')
							        .style('text-anchor', 'middle')
							        .style('font-family', 'Abel')
			    					.style('font-weight', 'bold')
			    					.style('font-size', '20px')
							        .text('Probability');

								//drawing data line
							    var lineFunc = d3.svg.line()
							    	.x(function(d)
							    	{
							    		return xScale(d.value);
							    	})
							    	.y(function(d)
							    	{
							    		return yScale(d.percentage);
							    	})
							    	.interpolate("cardinal")
							    	.tension(0.6);

							    vis.append('path')
							    	.attr('stroke', "red")
							    	.attr('stroke-width', 4)
							    	.attr('opacity', 0.6)
							    	.attr('fill', 'none')
							    	.attr('d', lineFunc(myValues));
							    console.log("Read data for: " + LineData.Feature.Type + " " + LineData.Feature.Value);


							    //writting Title
							    vis.append('text')
							        .attr('x', (WIDTH / 2))     
							        .attr('y', 0 + (MARGINS.top / 2))
							        .attr('text-anchor', 'middle')
							        .style('font-size', '24px')
							        .style('font-family', 'Abel')
			    					.style('font-weight', 'bold')
							        .text(IV + ' vs ' + LineData.Feature.Type + ' ' + LineData.Feature.Value);
							}

						{% endfor %}

					</script>
				</div>
			</div>
		</div>
		<nav class="navbar navbar-fixed-bottom" style="background-color: #77bbbb; color:black;">
			<div class="container">
				<p style="text-align: center; margin-top: 10px"><i>Some sample text for the footer</i></p>
			</div>
		</nav>


	    <!-- Bootstrap core JavaScript
	    ================================================== -->
	    <!-- Placed at the end of the document so the pages load faster -->
	    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
      <script>window.jQuery || document.write('<script src="{% static 'js/jquery.min.js' %}"><\/script>')</script>
      <script src="{% static 'js/bootstrap.min.js' %}"></script>
	    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
      <script src="{% static 'js/ie10-viewport-bug-workaround.js' %}"></script>
	</body>
	
</html>
